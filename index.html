<!DOCTYPE html><html><head><title>Twilio Chat</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Twilio Chat"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Twilio Chat</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement a simple chat application using Twilio IP Messaging Client</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Twilio Chat Swift" class="chapter"><div data-title="Introduction" data-file="app/src/main/AndroidManifest.xml" class="step"><h2 id="introduction">Introduction</h2>
<p>Ready to implement a chat application using Twilio IP Messaging Client?
Here is how it works at a high level:</p>
<ol>
<li><p>We use <a href="//www.parse.com/">Parse</a> to handle session management and user
registration in our app. </p>
</li>
<li><p><a href="//www.twilio.com/ip-messaging">Twilio IP Messaging</a> is the core product
we&#39;ll be using to handle all the chat functionality.</p>
</li>
<li><p>We use a server side app to generate <a href="//www.twilio.com/docs/api/ip-messaging/guides/identity">user access
tokens</a> which contains
all your Twilio account information. The IP Messaging Client uses this token
to connect with the API</p>
</li>
<li><p><a href="//media.twiliocdn.com/sdk/rtc/android/common/releases/0.1.10.b62-b0c2c3f/docs">Twilio Common</a>
is the part of the SDK than handles access tokens and even refreshes them upon token
expiration.</p>
</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/ip-messaging">IP Messaging API</a></li>
<li><a href="//www.twilio.com/docs/api/ip-messaging/guides/channels">Channels and Messages</a></li>
<li><a href="//www.twilio.com/docs/api/ip-messaging/guides/channels">User Identity &amp; Access Tokens</a></li>
<li><a href="//media.twiliocdn.com/sdk/rtc/android/ip-messaging/releases/0.4.10.b204-57cc05a/docs">Twilio IP Messaging Client Reference</a></li>
<li><a href="//media.twiliocdn.com/sdk/rtc/android/common/releases/0.1.10.b62-b0c2c3f/docs">Twilio Common Reference</a></li>
</ul>
</div><div data-title="Initializing the Client" data-file="app/src/main/java/com/twilio/twiliochat/ipmessaging/IPMessagingClientManager.java" data-highlight="83-151" class="step"><h2 id="initializing-the-ip-messaging-client">Initializing the IP Messaging Client</h2>
<p>The only thing you need to create a client, is an access token. This token
holds information about your Twilio account and IP Messaging API keys. You
can find an example application written in node that demonstrates how to
generate the token <a href="//github.com/TwilioDevEd/twiliochat">here</a>.</p>
<p>We use <a href="//parse.com/docs/cloudcode/guide#cloud-code-advanced-cloud-code-webhooks">Parse cloud code
webhooks</a>
to make a request to our server and get the access token.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//parse.com/docs/cloudcode/guide#cloud-code-advanced-cloud-code-webhooks">Parse cloud code webhooks</a></li>
</ul>
</div><div data-title="Getting the Channel List" data-file="app/src/main/java/com/twilio/twiliochat/ipmessaging/ChannelManager.java" data-highlight="60-94" class="step"><h2 id="getting-the-channel-list">Getting the Channel List</h2>
<p>Our <code>ChannelManager</code> class takes care of everything related to channels.
The first thing we need to do when the class is initialized, is to store
a list of channels of type <code>Channels</code> that we get by calling the method <code>getChannels</code>
from the IP Messaging Client.</p>
<p>Once we have a <code>Channels</code> object, we can fetch the actual channels using the
<code>Channels&#39;</code> method <code>loadChannelsWithListener</code>. Once that operation
finishes successfully, call the method <code>getChannels</code> on the same object, to
get an array of channels.</p>
</div><div data-title="Join the General Channel" data-file="app/src/main/java/com/twilio/twiliochat/ipmessaging/ChannelManager.java" data-highlight="113-162" class="step"><h2 id="join-the-general-channel">Join the General Channel</h2>
<p>This application will try to join a channel called &quot;General Channel&quot; when it starts.
If the channel doesn&#39;t exist, we&#39;ll create one with that name. The scope of
this example application will show you how to work only with public channels,
but the IP Messaging client allows you to create private channels and handle
invitations.</p>
<p>Notice we set a unique name for the general channel as we don&#39;t want to
create a new general channel every time we start the application.</p>
</div><div data-title="Listen to Channel Events" data-file="app/src/main/java/com/twilio/twiliochat/fragments/MainChatFragment.java" data-highlight="166-181" class="step"><h2 id="listen-to-channel-events">Listen to Channel Events</h2>
<p>We set a channel&#39;s listener to <code>MainChatFragment</code> that implements <code>ChannelListener</code>,
and here we implemented the following methods that listen to channel events:</p>
<ul>
<li><code>messageAdded</code>: When someone sends a message to the channel you are connected to.</li>
<li><code>memberJoined</code>: When someone joins the channel.</li>
<li><code>memberLeft</code>: When someone leaves the channel.</li>
</ul>
<p>As you may have noticed, each one of these methods include useful objects
as parameters, such as the actual message that was added to the channel.</p>
</div><div data-title="Joining Other Channels" data-file="app/src/main/java/com/twilio/twiliochat/fragments/MainChatFragment.java" data-highlight="109-146" class="step"><h2 id="joining-other-channels">Joining Other Channels</h2>
<p>The application uses a <a href="//developer.android.com/reference/android/support/v4/widget/DrawerLayout.html">Drawer Layout</a>
to show a list of the channels created for that Twilio account.</p>
<p>When you tap on the name of a channel from the sidebar, that channel is set
on the <code>MainChatFragment</code>. The <code>setCurrentChannel</code> method takes care of joining
to the selected channel and loading the messages.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="app/src/main/AndroidManifest.xml" data-mode="xml">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPG1hbmlmZXN0CiAgICBwYWNrYWdlPSJjb20udHdpbGlvLnR3aWxpb2NoYXQiCiAgICB4bWxuczphbmRyb2lkPSJodHRwOi8vc2NoZW1hcy5hbmRyb2lkLmNvbS9hcGsvcmVzL2FuZHJvaWQiPgoKICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uSU5URVJORVQiLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uQUNDRVNTX05FVFdPUktfU1RBVEUiLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uQUNDRVNTX1dJRklfU1RBVEUiLz4KICAgIDx1c2VzLXBlcm1pc3Npb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLnBlcm1pc3Npb24uV0FLRV9MT0NLIi8+CgogICAgPGFwcGxpY2F0aW9uCiAgICAgICAgYW5kcm9pZDpuYW1lPSIuYXBwbGljYXRpb24uVHdpbGlvQ2hhdEFwcGxpY2F0aW9uIgogICAgICAgIGFuZHJvaWQ6YWxsb3dCYWNrdXA9InRydWUiCiAgICAgICAgYW5kcm9pZDppY29uPSJAbWlwbWFwL2ljX2xhdW5jaGVyIgogICAgICAgIGFuZHJvaWQ6bGFiZWw9IkBzdHJpbmcvYXBwX25hbWUiCiAgICAgICAgYW5kcm9pZDpzdXBwb3J0c1J0bD0idHJ1ZSIKICAgICAgICBhbmRyb2lkOnRoZW1lPSJAc3R5bGUvQXBwVGhlbWUiPgogICAgICAgIDxtZXRhLWRhdGEKICAgICAgICAgICAgYW5kcm9pZDpuYW1lPSJjb20ucGFyc2UuQVBQTElDQVRJT05fSUQiCiAgICAgICAgICAgIGFuZHJvaWQ6dmFsdWU9IkBzdHJpbmcvcGFyc2VfYXBwX2lkIi8+CiAgICAgICAgPG1ldGEtZGF0YQogICAgICAgICAgICBhbmRyb2lkOm5hbWU9ImNvbS5wYXJzZS5DTElFTlRfS0VZIgogICAgICAgICAgICBhbmRyb2lkOnZhbHVlPSJAc3RyaW5nL3BhcnNlX2NsaWVudF9rZXkiLz4KCiAgICAgICAgPGFjdGl2aXR5CiAgICAgICAgICAgIGFuZHJvaWQ6bmFtZT0iLmFjdGl2aXRpZXMuTGF1bmNoQWN0aXZpdHkiCiAgICAgICAgICAgIGFuZHJvaWQ6bGFiZWw9IkBzdHJpbmcvYXBwX25hbWUiPgogICAgICAgICAgICA8aW50ZW50LWZpbHRlcj4KICAgICAgICAgICAgICAgIDxhY3Rpb24gYW5kcm9pZDpuYW1lPSJhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTiIvPgoKICAgICAgICAgICAgICAgIDxjYXRlZ29yeSBhbmRyb2lkOm5hbWU9ImFuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSIi8+CiAgICAgICAgICAgIDwvaW50ZW50LWZpbHRlcj4KICAgICAgICA8L2FjdGl2aXR5PgogICAgICAgIDxhY3Rpdml0eQogICAgICAgICAgICBhbmRyb2lkOm5hbWU9Ii5hY3Rpdml0aWVzLkxvZ2luQWN0aXZpdHkiCiAgICAgICAgICAgIGFuZHJvaWQ6c2NyZWVuT3JpZW50YXRpb249InBvcnRyYWl0Ii8+CiAgICAgICAgPGFjdGl2aXR5CiAgICAgICAgICAgIGFuZHJvaWQ6bmFtZT0iLmFjdGl2aXRpZXMuTWFpbkNoYXRBY3Rpdml0eSIKICAgICAgICAgICAgYW5kcm9pZDpjb25maWdDaGFuZ2VzPSJvcmllbnRhdGlvbnxzY3JlZW5TaXplIgogICAgICAgICAgICBhbmRyb2lkOmxhYmVsPSJAc3RyaW5nL3RpdGxlX2FjdGl2aXR5X21haW5fY2hhdCIKICAgICAgICAgICAgYW5kcm9pZDp0aGVtZT0iQHN0eWxlL0FwcFRoZW1lLk5vQWN0aW9uQmFyIi8+CiAgICAgICAgPGFjdGl2aXR5CiAgICAgICAgICAgIGFuZHJvaWQ6bmFtZT0iLmFjdGl2aXRpZXMuRm9yZ290UGFzc3dvcmRBY3Rpdml0eSIKICAgICAgICAgICAgYW5kcm9pZDpzY3JlZW5PcmllbnRhdGlvbj0icG9ydHJhaXQiLz4KCiAgICAgICAgPHNlcnZpY2UKICAgICAgICAgICAgYW5kcm9pZDpuYW1lPSJjb20udHdpbGlvLmlwbWVzc2FnaW5nLlR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50U2VydmljZSIKICAgICAgICAgICAgYW5kcm9pZDpleHBvcnRlZD0iZmFsc2UiLz4KICAgIDwvYXBwbGljYXRpb24+Cgo8L21hbmlmZXN0Pgo=</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/ipmessaging/IPMessagingClientManager.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuaXBtZXNzYWdpbmc7CgppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IGFuZHJvaWQuY29udGVudC5Db250ZXh0OwppbXBvcnQgYW5kcm9pZC5vcy5IYW5kbGVyOwppbXBvcnQgYW5kcm9pZC5wcm92aWRlci5TZXR0aW5nczsKCmltcG9ydCBjb20ucGFyc2UuRnVuY3Rpb25DYWxsYmFjazsKaW1wb3J0IGNvbS5wYXJzZS5QYXJzZUNsb3VkOwppbXBvcnQgY29tLnBhcnNlLlBhcnNlRXhjZXB0aW9uOwppbXBvcnQgY29tLnR3aWxpby5jb21tb24uVHdpbGlvQWNjZXNzTWFuYWdlcjsKaW1wb3J0IGNvbS50d2lsaW8uY29tbW9uLlR3aWxpb0FjY2Vzc01hbmFnZXJGYWN0b3J5OwppbXBvcnQgY29tLnR3aWxpby5jb21tb24uVHdpbGlvQWNjZXNzTWFuYWdlckxpc3RlbmVyOwppbXBvcnQgY29tLnR3aWxpby5pcG1lc3NhZ2luZy5DaGFubmVsOwppbXBvcnQgY29tLnR3aWxpby5pcG1lc3NhZ2luZy5Db25zdGFudHM7CmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLklQTWVzc2FnaW5nQ2xpZW50TGlzdGVuZXI7CmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLlR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50OwppbXBvcnQgY29tLnR3aWxpby5pcG1lc3NhZ2luZy5Ud2lsaW9JUE1lc3NhZ2luZ1NESzsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5pbnRlcmZhY2VzLkZldGNoVG9rZW5MaXN0ZW5lcjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5pbnRlcmZhY2VzLkxvZ2luTGlzdGVuZXI7CgpwdWJsaWMgY2xhc3MgSVBNZXNzYWdpbmdDbGllbnRNYW5hZ2VyCiAgICBpbXBsZW1lbnRzIElQTWVzc2FnaW5nQ2xpZW50TGlzdGVuZXIsIFR3aWxpb0FjY2Vzc01hbmFnZXJMaXN0ZW5lciB7CiAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgVE9LRU5fS0VZID0gInRva2VuIjsKICBwcml2YXRlIGZpbmFsIEhhbmRsZXIgaGFuZGxlciA9IG5ldyBIYW5kbGVyKCk7CiAgcHJpdmF0ZSBTdHJpbmcgY2FwYWJpbGl0eVRva2VuOwogIHByaXZhdGUgVHdpbGlvSVBNZXNzYWdpbmdDbGllbnQgaXBNZXNzYWdpbmdDbGllbnQ7CiAgcHJpdmF0ZSBDb250ZXh0IGNvbnRleHQ7CiAgcHJpdmF0ZSBUd2lsaW9BY2Nlc3NNYW5hZ2VyIGFjY2Vzc01hbmFnZXI7CgogIHB1YmxpYyBJUE1lc3NhZ2luZ0NsaWVudE1hbmFnZXIoQ29udGV4dCBjb250ZXh0KSB7CiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0OwogIH0KCiAgcHVibGljIElQTWVzc2FnaW5nQ2xpZW50TWFuYWdlcigpIHt9CgogIHB1YmxpYyBTdHJpbmcgZ2V0Q2FwYWJpbGl0eVRva2VuKCkgewogICAgcmV0dXJuIGNhcGFiaWxpdHlUb2tlbjsKICB9CgogIHB1YmxpYyB2b2lkIHNldENhcGFiaWxpdHlUb2tlbihTdHJpbmcgY2FwYWJpbGl0eVRva2VuKSB7CiAgICB0aGlzLmNhcGFiaWxpdHlUb2tlbiA9IGNhcGFiaWxpdHlUb2tlbjsKICAgIGlmICh0aGlzLmFjY2Vzc01hbmFnZXIgIT0gbnVsbCkgewogICAgICB0aGlzLmFjY2Vzc01hbmFnZXIudXBkYXRlVG9rZW4oY2FwYWJpbGl0eVRva2VuKTsKICAgIH0KICB9CgogIHB1YmxpYyB2b2lkIHNldENsaWVudExpc3RlbmVyKElQTWVzc2FnaW5nQ2xpZW50TGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgIGlmICh0aGlzLmlwTWVzc2FnaW5nQ2xpZW50ICE9IG51bGwpIHsKICAgICAgdGhpcy5pcE1lc3NhZ2luZ0NsaWVudC5zZXRMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICB9CiAgfQoKICBwdWJsaWMgVHdpbGlvSVBNZXNzYWdpbmdDbGllbnQgZ2V0SXBNZXNzYWdpbmdDbGllbnQoKSB7CiAgICByZXR1cm4gdGhpcy5pcE1lc3NhZ2luZ0NsaWVudDsKICB9CgogIHB1YmxpYyB2b2lkIHNldElwTWVzc2FnaW5nQ2xpZW50KFR3aWxpb0lQTWVzc2FnaW5nQ2xpZW50IGNsaWVudCkgewogICAgdGhpcy5pcE1lc3NhZ2luZ0NsaWVudCA9IGNsaWVudDsKICB9CgogIHB1YmxpYyB2b2lkIGNvbm5lY3RDbGllbnQoZmluYWwgTG9naW5MaXN0ZW5lciBsaXN0ZW5lcikgewogICAgVHdpbGlvSVBNZXNzYWdpbmdTREsuc2V0TG9nTGV2ZWwoYW5kcm9pZC51dGlsLkxvZy5ERUJVRyk7CiAgICBpZiAoIVR3aWxpb0lQTWVzc2FnaW5nU0RLLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICBUd2lsaW9JUE1lc3NhZ2luZ1NESy5pbml0aWFsaXplU0RLKGNvbnRleHQsIG5ldyBDb25zdGFudHMuSW5pdExpc3RlbmVyKCkgewogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9uSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICBjcmVhdGVDbGllbnRXaXRoQWNjZXNzTWFuYWdlcihsaXN0ZW5lcik7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKEV4Y2VwdGlvbiBlcnJvcikgewogICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvciBpbml0aWFsaXppbmcgdGhlIFNESyA6IiArIGVycm9yLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGNyZWF0ZUNsaWVudFdpdGhBY2Nlc3NNYW5hZ2VyKGxpc3RlbmVyKTsKICAgIH0KICB9CgogIHByaXZhdGUgdm9pZCBjcmVhdGVDbGllbnRXaXRoQWNjZXNzTWFuYWdlcihmaW5hbCBMb2dpbkxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICBmZXRjaEFjY2Vzc1Rva2VuKG5ldyBGZXRjaFRva2VuTGlzdGVuZXIoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBmZXRjaFRva2VuU3VjY2VzcyhTdHJpbmcgdG9rZW4pIHsKICAgICAgICBpbml0aWFsaXplQ2xpZW50V2l0aFRva2VuKHRva2VuLCBsaXN0ZW5lcik7CiAgICAgIH0KCiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBmZXRjaFRva2VuRmFpbHVyZShQYXJzZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgICAgIGxpc3RlbmVyLm9uTG9naW5FcnJvcihlLmdldExvY2FsaXplZE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBpbml0aWFsaXplQ2xpZW50V2l0aFRva2VuKFN0cmluZyB0b2tlbiwgZmluYWwgTG9naW5MaXN0ZW5lciBsaXN0ZW5lcikgewogICAgdGhpcy5hY2Nlc3NNYW5hZ2VyID0KICAgICAgICBUd2lsaW9BY2Nlc3NNYW5hZ2VyRmFjdG9yeS5jcmVhdGVBY2Nlc3NNYW5hZ2VyKHRva2VuLCBuZXcgVHdpbGlvQWNjZXNzTWFuYWdlckxpc3RlbmVyKCkgewogICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICBwdWJsaWMgdm9pZCBvbkFjY2Vzc01hbmFnZXJUb2tlbkV4cGlyZShUd2lsaW9BY2Nlc3NNYW5hZ2VyIHR3aWxpb0FjY2Vzc01hbmFnZXIpIHsKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJ0b2tlbiBleHBpcmVkLiIpOwogICAgICAgICAgICBmZXRjaEFjY2Vzc1Rva2VuKG5ldyBGZXRjaFRva2VuTGlzdGVuZXIoKSB7CiAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgcHVibGljIHZvaWQgZmV0Y2hUb2tlblN1Y2Nlc3MoU3RyaW5nIHRva2VuKSB7CiAgICAgICAgICAgICAgICBJUE1lc3NhZ2luZ0NsaWVudE1hbmFnZXIudGhpcy5hY2Nlc3NNYW5hZ2VyLnVwZGF0ZVRva2VuKHRva2VuKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGZldGNoVG9rZW5GYWlsdXJlKFBhcnNlRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3IgdHJ5aW5nIHRvIGZldGNoIHRva2VuOiAiICsgZS5nZXRMb2NhbGl6ZWRNZXNzYWdlKCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICBwdWJsaWMgdm9pZCBvblRva2VuVXBkYXRlZChUd2lsaW9BY2Nlc3NNYW5hZ2VyIHR3aWxpb0FjY2Vzc01hbmFnZXIpIHsKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJ0b2tlbiB1cGRhdGVkLiIpOwogICAgICAgICAgfQoKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25FcnJvcihUd2lsaW9BY2Nlc3NNYW5hZ2VyIHR3aWxpb0FjY2Vzc01hbmFnZXIsIFN0cmluZyBzKSB7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigidG9rZW4gZXJyb3I6ICIgKyBzKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICBpcE1lc3NhZ2luZ0NsaWVudCA9CiAgICAgICAgVHdpbGlvSVBNZXNzYWdpbmdTREsuY3JlYXRlSVBNZXNzYWdpbmdDbGllbnRXaXRoQWNjZXNzTWFuYWdlcih0aGlzLmFjY2Vzc01hbmFnZXIsIHRoaXMpOwogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25Mb2dpbkZpbmlzaGVkKCk7CiAgICB9CiAgfQoKICBwcml2YXRlIHZvaWQgZmV0Y2hBY2Nlc3NUb2tlbihmaW5hbCBGZXRjaFRva2VuTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgIFBhcnNlQ2xvdWQuY2FsbEZ1bmN0aW9uSW5CYWNrZ3JvdW5kKFRPS0VOX0tFWSwgZ2V0VG9rZW5SZXF1ZXN0UGFyYW1zKCksCiAgICAgICAgbmV3IEZ1bmN0aW9uQ2FsbGJhY2s8T2JqZWN0PigpIHsKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgZG9uZShPYmplY3Qgb2JqZWN0LCBQYXJzZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChlICE9IG51bGwpIHsKICAgICAgICAgICAgICBsaXN0ZW5lci5mZXRjaFRva2VuRmFpbHVyZShlKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTWFwPFN0cmluZywgU3RyaW5nPiByZXN1bHQgPSAoSGFzaE1hcDxTdHJpbmcsIFN0cmluZz4pIG9iamVjdDsKICAgICAgICAgICAgU3RyaW5nIHRva2VuID0gcmVzdWx0LmdldChUT0tFTl9LRVkpOwogICAgICAgICAgICBJUE1lc3NhZ2luZ0NsaWVudE1hbmFnZXIudGhpcy5jYXBhYmlsaXR5VG9rZW4gPSBjYXBhYmlsaXR5VG9rZW47CiAgICAgICAgICAgIGxpc3RlbmVyLmZldGNoVG9rZW5TdWNjZXNzKHRva2VuKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICB9CgogIHByaXZhdGUgTWFwPFN0cmluZywgU3RyaW5nPiBnZXRUb2tlblJlcXVlc3RQYXJhbXMoKSB7CiAgICBTdHJpbmcgYW5kcm9pZF9pZCA9CiAgICAgICAgU2V0dGluZ3MuU2VjdXJlLmdldFN0cmluZyhjb250ZXh0LmdldENvbnRlbnRSZXNvbHZlcigpLCBTZXR0aW5ncy5TZWN1cmUuQU5EUk9JRF9JRCk7CiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IHBhcmFtcyA9IG5ldyBIYXNoTWFwPD4oKTsKICAgIHBhcmFtcy5wdXQoImRldmljZSIsIGFuZHJvaWRfaWQpOwoKICAgIHJldHVybiBwYXJhbXM7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkNoYW5uZWxBZGQoQ2hhbm5lbCBjaGFubmVsKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsQ2hhbmdlKENoYW5uZWwgY2hhbm5lbCkgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbERlbGV0ZShDaGFubmVsIGNoYW5uZWwpIHsKCiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkVycm9yKGludCBpLCBTdHJpbmcgcykgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQXR0cmlidXRlc0NoYW5nZShTdHJpbmcgcykgewoKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbEhpc3RvcnlMb2FkZWQoQ2hhbm5lbCBjaGFubmVsKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25BY2Nlc3NNYW5hZ2VyVG9rZW5FeHBpcmUoVHdpbGlvQWNjZXNzTWFuYWdlciB0d2lsaW9BY2Nlc3NNYW5hZ2VyKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25Ub2tlblVwZGF0ZWQoVHdpbGlvQWNjZXNzTWFuYWdlciB0d2lsaW9BY2Nlc3NNYW5hZ2VyKSB7CgogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25FcnJvcihUd2lsaW9BY2Nlc3NNYW5hZ2VyIHR3aWxpb0FjY2Vzc01hbmFnZXIsIFN0cmluZyBzKSB7CgogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/ipmessaging/ChannelManager.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuaXBtZXNzYWdpbmc7CgppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBhbmRyb2lkLmNvbnRlbnQucmVzLlJlc291cmNlczsKaW1wb3J0IGFuZHJvaWQub3MuSGFuZGxlcjsKaW1wb3J0IGFuZHJvaWQub3MuTG9vcGVyOwoKaW1wb3J0IGNvbS50d2lsaW8uaXBtZXNzYWdpbmcuQ2hhbm5lbDsKaW1wb3J0IGNvbS50d2lsaW8uaXBtZXNzYWdpbmcuQ2hhbm5lbC5DaGFubmVsVHlwZTsKaW1wb3J0IGNvbS50d2lsaW8uaXBtZXNzYWdpbmcuQ2hhbm5lbHM7CmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLkNvbnN0YW50czsKaW1wb3J0IGNvbS50d2lsaW8uaXBtZXNzYWdpbmcuSVBNZXNzYWdpbmdDbGllbnRMaXN0ZW5lcjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5SOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LmFwcGxpY2F0aW9uLlR3aWxpb0NoYXRBcHBsaWNhdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbGlvY2hhdC5pbnRlcmZhY2VzLkxvYWRDaGFubmVsTGlzdGVuZXI7CgpwdWJsaWMgY2xhc3MgQ2hhbm5lbE1hbmFnZXIgaW1wbGVtZW50cyBJUE1lc3NhZ2luZ0NsaWVudExpc3RlbmVyIHsKICBwcml2YXRlIHN0YXRpYyBDaGFubmVsTWFuYWdlciBzaGFyZWRNYW5hZ2VyID0gbmV3IENoYW5uZWxNYW5hZ2VyKCk7CiAgcHVibGljIENoYW5uZWwgZ2VuZXJhbENoYW5uZWw7CiAgcHJpdmF0ZSBJUE1lc3NhZ2luZ0NsaWVudE1hbmFnZXIgY2xpZW50OwogIHByaXZhdGUgTGlzdDxDaGFubmVsPiBjaGFubmVsczsKICBwcml2YXRlIENoYW5uZWxzIGNoYW5uZWxzT2JqZWN0OwogIHByaXZhdGUgQ2hhbm5lbFtdIGNoYW5uZWxBcnJheTsKICBwcml2YXRlIElQTWVzc2FnaW5nQ2xpZW50TGlzdGVuZXIgbGlzdGVuZXI7CiAgcHJpdmF0ZSBTdHJpbmcgZGVmYXVsdENoYW5uZWxOYW1lOwogIHByaXZhdGUgU3RyaW5nIGRlZmF1bHRDaGFubmVsVW5pcXVlTmFtZTsKICBwcml2YXRlIEhhbmRsZXIgaGFuZGxlcjsKICBwcml2YXRlIEJvb2xlYW4gaXNSZWZyZXNoaW5nQ2hhbm5lbHMgPSBmYWxzZTsKCiAgcHJpdmF0ZSBDaGFubmVsTWFuYWdlcigpIHsKICAgIHRoaXMuY2xpZW50ID0gVHdpbGlvQ2hhdEFwcGxpY2F0aW9uLmdldCgpLmdldElQTWVzc2FnaW5nQ2xpZW50KCk7CiAgICB0aGlzLmxpc3RlbmVyID0gdGhpczsKICAgIGRlZmF1bHRDaGFubmVsTmFtZSA9IGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLmRlZmF1bHRfY2hhbm5lbF9uYW1lKTsKICAgIGRlZmF1bHRDaGFubmVsVW5pcXVlTmFtZSA9IGdldFN0cmluZ1Jlc291cmNlKFIuc3RyaW5nLmRlZmF1bHRfY2hhbm5lbF91bmlxdWVfbmFtZSk7CiAgICBoYW5kbGVyID0gc2V0dXBMaXN0ZW5lckhhbmRsZXIoKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgQ2hhbm5lbE1hbmFnZXIgZ2V0SW5zdGFuY2UoKSB7CiAgICByZXR1cm4gc2hhcmVkTWFuYWdlcjsKICB9CgogIHB1YmxpYyBMaXN0PENoYW5uZWw+IGdldENoYW5uZWxzKCkgewogICAgcmV0dXJuIGNoYW5uZWxzOwogIH0KCiAgcHVibGljIHZvaWQgbGVhdmVDaGFubmVsV2l0aEhhbmRsZXIoQ2hhbm5lbCBjaGFubmVsLCBDb25zdGFudHMuU3RhdHVzTGlzdGVuZXIgaGFuZGxlcikgewogICAgY2hhbm5lbC5sZWF2ZShoYW5kbGVyKTsKICB9CgogIHB1YmxpYyB2b2lkIGRlbGV0ZUNoYW5uZWxXaXRoSGFuZGxlcihDaGFubmVsIGNoYW5uZWwsIENvbnN0YW50cy5TdGF0dXNMaXN0ZW5lciBoYW5kbGVyKSB7CiAgICBjaGFubmVsLmRlc3Ryb3koaGFuZGxlcik7CiAgfQoKICBwdWJsaWMgdm9pZCBwb3B1bGF0ZUNoYW5uZWxzKGZpbmFsIExvYWRDaGFubmVsTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgIGlmICh0aGlzLmNsaWVudCA9PSBudWxsIHx8IHRoaXMuaXNSZWZyZXNoaW5nQ2hhbm5lbHMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5pc1JlZnJlc2hpbmdDaGFubmVscyA9IHRydWU7CiAgICBoYW5kbGVyLnBvc3QobmV3IFJ1bm5hYmxlKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIGNoYW5uZWxzT2JqZWN0ID0gY2xpZW50LmdldElwTWVzc2FnaW5nQ2xpZW50KCkuZ2V0Q2hhbm5lbHMoKTsKICAgICAgICBpZiAoY2hhbm5lbHNPYmplY3QgIT0gbnVsbCkgewogICAgICAgICAgY2hhbm5lbHNPYmplY3QubG9hZENoYW5uZWxzV2l0aExpc3RlbmVyKG5ldyBDb25zdGFudHMuU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKCkgewogICAgICAgICAgICAgIENoYW5uZWxNYW5hZ2VyLnRoaXMuaXNSZWZyZXNoaW5nQ2hhbm5lbHMgPSBmYWxzZTsKICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkZhaWxlZCB0byBsb2FkQ2hhbm5lbHNXaXRoTGlzdGVuZXIiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uU3VjY2VzcygpIHsKICAgICAgICAgICAgICBjaGFubmVscyA9IG5ldyBBcnJheUxpc3Q8PigpOwoKICAgICAgICAgICAgICBjaGFubmVsQXJyYXkgPSBjaGFubmVsc09iamVjdC5nZXRDaGFubmVscygpOwogICAgICAgICAgICAgIGlmIChDaGFubmVsTWFuYWdlci50aGlzLmNoYW5uZWxzICE9IG51bGwgJiYgY2hhbm5lbEFycmF5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENoYW5uZWxNYW5hZ2VyLnRoaXMuY2hhbm5lbHMuYWRkQWxsKEFycmF5cy5hc0xpc3QoY2hhbm5lbEFycmF5KSk7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9ucy5zb3J0KENoYW5uZWxNYW5hZ2VyLnRoaXMuY2hhbm5lbHMsIG5ldyBDdXN0b21DaGFubmVsQ29tcGFyYXRvcigpKTsKICAgICAgICAgICAgICAgIENoYW5uZWxNYW5hZ2VyLnRoaXMuaXNSZWZyZXNoaW5nQ2hhbm5lbHMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNsaWVudC5zZXRDbGllbnRMaXN0ZW5lcihDaGFubmVsTWFuYWdlci50aGlzKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyLm9uQ2hhbm5lbHNGaW5pc2hlZExvYWRpbmcoQ2hhbm5lbE1hbmFnZXIudGhpcy5jaGFubmVscyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHVibGljIHZvaWQgY3JlYXRlQ2hhbm5lbFdpdGhOYW1lKFN0cmluZyBuYW1lLCBmaW5hbCBDb25zdGFudHMuU3RhdHVzTGlzdGVuZXIgaGFuZGxlcikgewogICAgTWFwPFN0cmluZywgT2JqZWN0PiBvcHRpb25zID0gbmV3IEhhc2hNYXA8PigpOwogICAgb3B0aW9ucy5wdXQoQ29uc3RhbnRzLkNIQU5ORUxfRlJJRU5ETFlfTkFNRSwgbmFtZSk7CiAgICBvcHRpb25zLnB1dChDb25zdGFudHMuQ0hBTk5FTF9UWVBFLCBDaGFubmVsVHlwZS5DSEFOTkVMX1RZUEVfUFVCTElDKTsKICAgIHRoaXMuY2hhbm5lbHNPYmplY3QuY3JlYXRlQ2hhbm5lbChvcHRpb25zLCBuZXcgQ29uc3RhbnRzLkNyZWF0ZUNoYW5uZWxMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uQ3JlYXRlZChDaGFubmVsIGNoYW5uZWwpIHsKICAgICAgICBoYW5kbGVyLm9uU3VjY2VzcygpOwogICAgICB9CgogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25FcnJvcigpIHsKICAgICAgICBoYW5kbGVyLm9uRXJyb3IoKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBwdWJsaWMgdm9pZCBqb2luT3JDcmVhdGVHZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGZpbmFsIENvbnN0YW50cy5TdGF0dXNMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgaWYgKHRoaXMuY2hhbm5lbHMgPT0gbnVsbCkgewogICAgICBsaXN0ZW5lci5vbkVycm9yKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZ2VuZXJhbENoYW5uZWwgPSBjaGFubmVsc09iamVjdC5nZXRDaGFubmVsQnlVbmlxdWVOYW1lKGRlZmF1bHRDaGFubmVsVW5pcXVlTmFtZSk7CiAgICBpZiAodGhpcy5nZW5lcmFsQ2hhbm5lbCAhPSBudWxsKSB7CiAgICAgIGpvaW5HZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGxpc3RlbmVyKTsKICAgIH0gZWxzZSB7CiAgICAgIGNyZWF0ZUdlbmVyYWxDaGFubmVsV2l0aENvbXBsZXRpb24obGlzdGVuZXIpOwogICAgfQogIH0KCiAgcHJpdmF0ZSB2b2lkIGpvaW5HZW5lcmFsQ2hhbm5lbFdpdGhDb21wbGV0aW9uKGZpbmFsIENvbnN0YW50cy5TdGF0dXNMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgaWYgKHRoaXMuZ2VuZXJhbENoYW5uZWwgPT0gbnVsbCkgewogICAgICBsaXN0ZW5lci5vbkVycm9yKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZ2VuZXJhbENoYW5uZWwuam9pbihuZXcgQ29uc3RhbnRzLlN0YXR1c0xpc3RlbmVyKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25TdWNjZXNzKCkgewogICAgICAgIGxpc3RlbmVyLm9uU3VjY2VzcygpOwogICAgICB9CgogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgb25FcnJvcigpIHsKICAgICAgICBsaXN0ZW5lci5vbkVycm9yKCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIGNyZWF0ZUdlbmVyYWxDaGFubmVsV2l0aENvbXBsZXRpb24oZmluYWwgQ29uc3RhbnRzLlN0YXR1c0xpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IG9wdGlvbnMgPSBuZXcgSGFzaE1hcDw+KCk7CiAgICBvcHRpb25zLnB1dChDb25zdGFudHMuQ0hBTk5FTF9GUklFTkRMWV9OQU1FLCBkZWZhdWx0Q2hhbm5lbE5hbWUpOwogICAgb3B0aW9ucy5wdXQoQ29uc3RhbnRzLkNIQU5ORUxfVU5JUVVFX05BTUUsIGRlZmF1bHRDaGFubmVsVW5pcXVlTmFtZSk7CiAgICBvcHRpb25zLnB1dChDb25zdGFudHMuQ0hBTk5FTF9UWVBFLCBDaGFubmVsVHlwZS5DSEFOTkVMX1RZUEVfUFVCTElDKTsKICAgIHRoaXMuY2hhbm5lbHNPYmplY3QuY3JlYXRlQ2hhbm5lbChvcHRpb25zLCBuZXcgQ29uc3RhbnRzLkNyZWF0ZUNoYW5uZWxMaXN0ZW5lcigpIHsKICAgICAgQE92ZXJyaWRlCiAgICAgIHB1YmxpYyB2b2lkIG9uQ3JlYXRlZChDaGFubmVsIGNoYW5uZWwpIHsKICAgICAgICBDaGFubmVsTWFuYWdlci50aGlzLmdlbmVyYWxDaGFubmVsID0gY2hhbm5lbDsKICAgICAgICBDaGFubmVsTWFuYWdlci50aGlzLmNoYW5uZWxzLmFkZChjaGFubmVsKTsKICAgICAgICBqb2luR2VuZXJhbENoYW5uZWxXaXRoQ29tcGxldGlvbihsaXN0ZW5lcik7CiAgICAgIH0KCiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKCkgewogICAgICAgIGxpc3RlbmVyLm9uRXJyb3IoKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBwdWJsaWMgdm9pZCBzZXRDaGFubmVsTGlzdGVuZXIoSVBNZXNzYWdpbmdDbGllbnRMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgdGhpcy5saXN0ZW5lciA9IGxpc3RlbmVyOwogIH0KCiAgcHJpdmF0ZSBTdHJpbmcgZ2V0U3RyaW5nUmVzb3VyY2UoaW50IGlkKSB7CiAgICBSZXNvdXJjZXMgcmVzb3VyY2VzID0gVHdpbGlvQ2hhdEFwcGxpY2F0aW9uLmdldCgpLmdldFJlc291cmNlcygpOwogICAgcmV0dXJuIHJlc291cmNlcy5nZXRTdHJpbmcoaWQpOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsQWRkKENoYW5uZWwgY2hhbm5lbCkgewogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25DaGFubmVsQWRkKGNoYW5uZWwpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsQ2hhbmdlKENoYW5uZWwgY2hhbm5lbCkgewogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25DaGFubmVsQ2hhbmdlKGNoYW5uZWwpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DaGFubmVsRGVsZXRlKENoYW5uZWwgY2hhbm5lbCkgewogICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgbGlzdGVuZXIub25DaGFubmVsRGVsZXRlKGNoYW5uZWwpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25FcnJvcihpbnQgaSwgU3RyaW5nIHMpIHsKICAgIGlmIChsaXN0ZW5lciAhPSBudWxsKSB7CiAgICAgIGxpc3RlbmVyLm9uRXJyb3IoaSwgcyk7CiAgICB9CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkF0dHJpYnV0ZXNDaGFuZ2UoU3RyaW5nIHMpIHsKICAgIGlmIChsaXN0ZW5lciAhPSBudWxsKSB7CiAgICAgIGxpc3RlbmVyLm9uQXR0cmlidXRlc0NoYW5nZShzKTsKICAgIH0KICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbEhpc3RvcnlMb2FkZWQoQ2hhbm5lbCBjaGFubmVsKSB7CiAgICBpZiAobGlzdGVuZXIgIT0gbnVsbCkgewogICAgICBsaXN0ZW5lci5vbkNoYW5uZWxIaXN0b3J5TG9hZGVkKGNoYW5uZWwpOwogICAgfQogIH0KCiAgcHJpdmF0ZSBIYW5kbGVyIHNldHVwTGlzdGVuZXJIYW5kbGVyKCkgewogICAgTG9vcGVyIGxvb3BlcjsKICAgIEhhbmRsZXIgaGFuZGxlcjsKICAgIGlmICgobG9vcGVyID0gTG9vcGVyLm15TG9vcGVyKCkpICE9IG51bGwpIHsKICAgICAgaGFuZGxlciA9IG5ldyBIYW5kbGVyKGxvb3Blcik7CiAgICB9IGVsc2UgaWYgKChsb29wZXIgPSBMb29wZXIuZ2V0TWFpbkxvb3BlcigpKSAhPSBudWxsKSB7CiAgICAgIGhhbmRsZXIgPSBuZXcgSGFuZGxlcihsb29wZXIpOwogICAgfSBlbHNlIHsKICAgICAgaGFuZGxlciA9IG51bGw7CiAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIkNoYW5uZWwgTGlzdGVuZXIgbXVzdCBoYXZlIGEgTG9vcGVyLiIpOwogICAgfQogICAgcmV0dXJuIGhhbmRsZXI7CiAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="app/src/main/java/com/twilio/twiliochat/fragments/MainChatFragment.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnR3aWxpb2NoYXQuZnJhZ21lbnRzOwoKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgYW5kcm9pZC5hcHAuQWN0aXZpdHk7CmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuQ29udGV4dDsKaW1wb3J0IGFuZHJvaWQub3MuQnVuZGxlOwppbXBvcnQgYW5kcm9pZC5zdXBwb3J0LnY0LmFwcC5GcmFnbWVudDsKaW1wb3J0IGFuZHJvaWQudmlldy5LZXlFdmVudDsKaW1wb3J0IGFuZHJvaWQudmlldy5MYXlvdXRJbmZsYXRlcjsKaW1wb3J0IGFuZHJvaWQudmlldy5WaWV3OwppbXBvcnQgYW5kcm9pZC52aWV3LlZpZXdHcm91cDsKaW1wb3J0IGFuZHJvaWQud2lkZ2V0LkJ1dHRvbjsKaW1wb3J0IGFuZHJvaWQud2lkZ2V0LkVkaXRUZXh0OwppbXBvcnQgYW5kcm9pZC53aWRnZXQuTGlzdFZpZXc7CmltcG9ydCBhbmRyb2lkLndpZGdldC5UZXh0VmlldzsKCmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLkNoYW5uZWw7CmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLkNoYW5uZWxMaXN0ZW5lcjsKaW1wb3J0IGNvbS50d2lsaW8uaXBtZXNzYWdpbmcuQ29uc3RhbnRzOwppbXBvcnQgY29tLnR3aWxpby5pcG1lc3NhZ2luZy5NZW1iZXI7CmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLk1lc3NhZ2U7CmltcG9ydCBjb20udHdpbGlvLmlwbWVzc2FnaW5nLk1lc3NhZ2VzOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0LlI7CmltcG9ydCBjb20udHdpbGlvLnR3aWxpb2NoYXQubWVzc2FnaW5nLk1lc3NhZ2VBZGFwdGVyOwppbXBvcnQgY29tLnR3aWxpby50d2lsaW9jaGF0Lm1lc3NhZ2luZy5TdGF0dXNNZXNzYWdlOwoKcHVibGljIGNsYXNzIE1haW5DaGF0RnJhZ21lbnQgZXh0ZW5kcyBGcmFnbWVudCBpbXBsZW1lbnRzIENoYW5uZWxMaXN0ZW5lciB7CiAgQ29udGV4dCBjb250ZXh0OwogIEFjdGl2aXR5IG1haW5BY3Rpdml0eTsKICBCdXR0b24gc2VuZEJ1dHRvbjsKICBMaXN0VmlldyBtZXNzYWdlc0xpc3RWaWV3OwogIEVkaXRUZXh0IG1lc3NhZ2VUZXh0RWRpdDsKCiAgTWVzc2FnZUFkYXB0ZXIgbWVzc2FnZUFkYXB0ZXI7CiAgQ2hhbm5lbCBjdXJyZW50Q2hhbm5lbDsKICBNZXNzYWdlcyBtZXNzYWdlczsKICBNZXNzYWdlW10gbWVzc2FnZXNBcnJheTsKCiAgcHVibGljIE1haW5DaGF0RnJhZ21lbnQoKSB7fQoKICBwdWJsaWMgc3RhdGljIE1haW5DaGF0RnJhZ21lbnQgbmV3SW5zdGFuY2UoKSB7CiAgICBNYWluQ2hhdEZyYWdtZW50IGZyYWdtZW50ID0gbmV3IE1haW5DaGF0RnJhZ21lbnQoKTsKICAgIHJldHVybiBmcmFnbWVudDsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ3JlYXRlKEJ1bmRsZSBzYXZlZEluc3RhbmNlU3RhdGUpIHsKICAgIHN1cGVyLm9uQ3JlYXRlKHNhdmVkSW5zdGFuY2VTdGF0ZSk7CiAgICBjb250ZXh0ID0gdGhpcy5nZXRBY3Rpdml0eSgpOwogICAgbWFpbkFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eSgpOwogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIFZpZXcgb25DcmVhdGVWaWV3KExheW91dEluZmxhdGVyIGluZmxhdGVyLCBWaWV3R3JvdXAgY29udGFpbmVyLAogICAgICBCdW5kbGUgc2F2ZWRJbnN0YW5jZVN0YXRlKSB7CiAgICBWaWV3IHZpZXcgPSBpbmZsYXRlci5pbmZsYXRlKFIubGF5b3V0LmZyYWdtZW50X21haW5fY2hhdCwgY29udGFpbmVyLCBmYWxzZSk7CiAgICBzZW5kQnV0dG9uID0gKEJ1dHRvbikgdmlldy5maW5kVmlld0J5SWQoUi5pZC5idXR0b25TZW5kKTsKICAgIG1lc3NhZ2VzTGlzdFZpZXcgPSAoTGlzdFZpZXcpIHZpZXcuZmluZFZpZXdCeUlkKFIuaWQubGlzdFZpZXdNZXNzYWdlcyk7CiAgICBtZXNzYWdlVGV4dEVkaXQgPSAoRWRpdFRleHQpIHZpZXcuZmluZFZpZXdCeUlkKFIuaWQuZWRpdFRleHRNZXNzYWdlKTsKCiAgICBtZXNzYWdlQWRhcHRlciA9IG5ldyBNZXNzYWdlQWRhcHRlcihtYWluQWN0aXZpdHkpOwogICAgbWVzc2FnZXNMaXN0Vmlldy5zZXRBZGFwdGVyKG1lc3NhZ2VBZGFwdGVyKTsKICAgIHNldFVwTGlzdGVuZXJzKCk7CiAgICBzZXRNZXNzYWdlSW5wdXRFbmFibGVkKGZhbHNlKTsKCiAgICByZXR1cm4gdmlldzsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQXR0YWNoKENvbnRleHQgY29udGV4dCkgewogICAgc3VwZXIub25BdHRhY2goY29udGV4dCk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkRldGFjaCgpIHsKICAgIHN1cGVyLm9uRGV0YWNoKCk7CiAgfQoKICBwcml2YXRlIHZvaWQgc2V0VXBMaXN0ZW5lcnMoKSB7CiAgICBzZW5kQnV0dG9uLnNldE9uQ2xpY2tMaXN0ZW5lcihuZXcgVmlldy5PbkNsaWNrTGlzdGVuZXIoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBvbkNsaWNrKFZpZXcgdikgewogICAgICAgIHNlbmRNZXNzYWdlKCk7CiAgICAgIH0KICAgIH0pOwogICAgbWVzc2FnZVRleHRFZGl0LnNldE9uRWRpdG9yQWN0aW9uTGlzdGVuZXIobmV3IFRleHRWaWV3Lk9uRWRpdG9yQWN0aW9uTGlzdGVuZXIoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgYm9vbGVhbiBvbkVkaXRvckFjdGlvbihUZXh0VmlldyB2LCBpbnQgYWN0aW9uSWQsIEtleUV2ZW50IGV2ZW50KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9KTsKICB9CgogIHByaXZhdGUgdm9pZCBzZW5kTWVzc2FnZSgpIHsKICAgIFN0cmluZyBtZXNzYWdlVGV4dCA9IGdldFRleHRJbnB1dCgpOwogICAgaWYgKG1lc3NhZ2VUZXh0Lmxlbmd0aCgpID09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgTWVzc2FnZSBuZXdNZXNzYWdlID0gdGhpcy5tZXNzYWdlcy5jcmVhdGVNZXNzYWdlKG1lc3NhZ2VUZXh0KTsKICAgIHRoaXMubWVzc2FnZXMuc2VuZE1lc3NhZ2UobmV3TWVzc2FnZSwgbnVsbCk7CiAgICBjbGVhclRleHRJbnB1dCgpOwogIH0KCiAgcHVibGljIENoYW5uZWwgZ2V0Q3VycmVudENoYW5uZWwoKSB7CiAgICByZXR1cm4gY3VycmVudENoYW5uZWw7CiAgfQoKICBwdWJsaWMgdm9pZCBzZXRDdXJyZW50Q2hhbm5lbChDaGFubmVsIGN1cnJlbnRDaGFubmVsLCBmaW5hbCBDb25zdGFudHMuU3RhdHVzTGlzdGVuZXIgaGFuZGxlcikgewogICAgaWYgKGN1cnJlbnRDaGFubmVsID09IG51bGwpIHsKICAgICAgdGhpcy5jdXJyZW50Q2hhbm5lbCA9IG51bGw7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghY3VycmVudENoYW5uZWwuZXF1YWxzKHRoaXMuY3VycmVudENoYW5uZWwpKSB7CiAgICAgIHNldE1lc3NhZ2VJbnB1dEVuYWJsZWQoZmFsc2UpOwogICAgICB0aGlzLmN1cnJlbnRDaGFubmVsID0gY3VycmVudENoYW5uZWw7CiAgICAgIHRoaXMuY3VycmVudENoYW5uZWwuc2V0TGlzdGVuZXIodGhpcyk7CiAgICAgIGlmICh0aGlzLmN1cnJlbnRDaGFubmVsLmdldFN0YXR1cygpID09IENoYW5uZWwuQ2hhbm5lbFN0YXR1cy5KT0lORUQpIHsKICAgICAgICBsb2FkTWVzc2FnZXMoaGFuZGxlcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jdXJyZW50Q2hhbm5lbC5qb2luKG5ldyBDb25zdGFudHMuU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgIHB1YmxpYyB2b2lkIG9uU3VjY2VzcygpIHsKICAgICAgICAgICAgbG9hZE1lc3NhZ2VzKGhhbmRsZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgcHVibGljIHZvaWQgb25FcnJvcigpIHt9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CgogIHByaXZhdGUgdm9pZCBsb2FkTWVzc2FnZXMoZmluYWwgQ29uc3RhbnRzLlN0YXR1c0xpc3RlbmVyIGhhbmRsZXIpIHsKICAgIHRoaXMubWVzc2FnZXMgPSB0aGlzLmN1cnJlbnRDaGFubmVsLmdldE1lc3NhZ2VzKCk7CiAgICBtZXNzYWdlc0FycmF5ID0gdGhpcy5tZXNzYWdlcy5nZXRNZXNzYWdlcygpOwogICAgbWFpbkFjdGl2aXR5LnJ1bk9uVWlUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICBAT3ZlcnJpZGUKICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIG1lc3NhZ2VBZGFwdGVyLnNldE1lc3NhZ2VzKG1lc3NhZ2VzQXJyYXkpOwogICAgICAgIHNldE1lc3NhZ2VJbnB1dEVuYWJsZWQodHJ1ZSk7CiAgICAgICAgbWVzc2FnZVRleHRFZGl0LnJlcXVlc3RGb2N1cygpOwogICAgICAgIGhhbmRsZXIub25TdWNjZXNzKCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSB2b2lkIHNldE1lc3NhZ2VJbnB1dEVuYWJsZWQoZmluYWwgYm9vbGVhbiBlbmFibGVkKSB7CiAgICBtYWluQWN0aXZpdHkucnVuT25VaVRocmVhZChuZXcgUnVubmFibGUoKSB7CiAgICAgIEBPdmVycmlkZQogICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgTWFpbkNoYXRGcmFnbWVudC50aGlzLnNlbmRCdXR0b24uc2V0RW5hYmxlZChlbmFibGVkKTsKICAgICAgICBNYWluQ2hhdEZyYWdtZW50LnRoaXMubWVzc2FnZVRleHRFZGl0LnNldEVuYWJsZWQoZW5hYmxlZCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHJpdmF0ZSBTdHJpbmcgZ2V0VGV4dElucHV0KCkgewogICAgcmV0dXJuIG1lc3NhZ2VUZXh0RWRpdC5nZXRUZXh0KCkudG9TdHJpbmcoKTsKICB9CgogIHByaXZhdGUgdm9pZCBjbGVhclRleHRJbnB1dCgpIHsKICAgIG1lc3NhZ2VUZXh0RWRpdC5zZXRUZXh0KCIiKTsKICB9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uTWVzc2FnZUFkZChNZXNzYWdlIG1lc3NhZ2UpIHsKICAgIG1lc3NhZ2VBZGFwdGVyLmFkZE1lc3NhZ2UobWVzc2FnZSk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbk1lbWJlckpvaW4oTWVtYmVyIG1lbWJlcikgewogICAgU3RhdHVzTWVzc2FnZSBzdGF0dXNNZXNzYWdlID0gbmV3IFN0YXR1c01lc3NhZ2UobWVtYmVyLmdldElkZW50aXR5KCksICJ0aW1lc3RhbXAiLCAiam9pbmVkIik7CiAgICB0aGlzLm1lc3NhZ2VBZGFwdGVyLmFkZFN0YXR1c01lc3NhZ2Uoc3RhdHVzTWVzc2FnZSk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbk1lbWJlckRlbGV0ZShNZW1iZXIgbWVtYmVyKSB7CiAgICBTdGF0dXNNZXNzYWdlIHN0YXR1c01lc3NhZ2UgPSBuZXcgU3RhdHVzTWVzc2FnZShtZW1iZXIuZ2V0SWRlbnRpdHkoKSwgInRpbWVzdGFtcCIsICJsZWZ0Iik7CiAgICB0aGlzLm1lc3NhZ2VBZGFwdGVyLmFkZFN0YXR1c01lc3NhZ2Uoc3RhdHVzTWVzc2FnZSk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbk1lc3NhZ2VDaGFuZ2UoTWVzc2FnZSBtZXNzYWdlKSB7fQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbk1lc3NhZ2VEZWxldGUoTWVzc2FnZSBtZXNzYWdlKSB7fQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbk1lbWJlckNoYW5nZShNZW1iZXIgbWVtYmVyKSB7fQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkF0dHJpYnV0ZXNDaGFuZ2UoTWFwPFN0cmluZywgU3RyaW5nPiBtYXApIHt9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uVHlwaW5nU3RhcnRlZChNZW1iZXIgbWVtYmVyKSB7fQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvblR5cGluZ0VuZGVkKE1lbWJlciBtZW1iZXIpIHt9CgogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uQ2hhbm5lbEhpc3RvcnlMb2FkZWQoQ2hhbm5lbCBjaGFubmVsKSB7fQp9Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/twiliochat-android" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>